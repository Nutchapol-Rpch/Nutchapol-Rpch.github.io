<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Car Accessories</title>
    <link rel="stylesheet" href="styles/general.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
        integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-3">
                <h1>Car Accessories</h1>
                <p>
                    <address>
                        <b>Address:</b><br />
                        <p style="margin-left: 30px; font-size: 15px;">
                        Bangsaothong<br />
                        Samutrprakarn<br />
                        Thailand<br />
                        10391<br />
                        </p>
                        <span class="glyphicon glyphicon-earphone" aria-hidden="true"></span>
                        : 12345678
                        <br>
                        <span class="glyphicon glyphicon-phone" aria-hidden="true"></span>
                        : 12345678
                    </address>
                </p>
            </div>
            <div class="col-sm-6"></div>
            <div class="col-sm-3 text-center">
                <h1>
                    Autosories Shop
                </h1>
                <img src="img/logo.jpg"
                    style="width:150px;height:150px; border-radius: 50%;">
            </div>
        </div>
    </div>
    <hr style="border: 1px solid black; margin-left: 80px; margin-right: 80px;">

        <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <address>
                    <h3>Customer:</h3>
                    <b>Sample customer name 001</b><br>
                    Sample address line1<br>
                    Sample address line2<br>
                    Sample address line3
                </address>
            </div>
            <div class="col-sm-4">
                <address>
                    <h3>Ship to:</h3>
                    <b>Sample customer name 001</b><br>
                    Sample address line1<br>
                    Sample address line2<br>
                    Sample address line3
                </address>

            </div>

            <div class="col-sm-4">
                <h4 id="quotationDate">
                    <h3>Order Date:</h3>
                    <fonts style="font-size: 18px;">2010/7/27</fonts>
                </h4>
            </div>
        </div>
    </div>

    <div class="container">
        <table class=" table table-striped table-condensed table-list" id="quotationTable">
            <h3>Add Accessory</h3>
            <!-- <select id="accessory-select">
                <option value="10">Car Cover</option>
                <option value="20">Seat Covers</option>
                <option value="30">Phone Holder</option> -->
                <!-- Add more options here -->
            <!-- </select> -->
            <!-- <input type="number" id="amount-input" min="1" value="1"> -->
            <!-- <button class="add-button" onclick="addItem()">Add</button> -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" style="margin-bottom: 13px;">
            Add product
            </button>
                <thead class="thead-list">
                    <tr>
                        <th>Accessory</th>
                        <th class="text-center">Quantity</th>
                        <th class="text-center">Unit Price</th>
                        <th class="text-center">Amount</th>
                    </tr>
                </thead>
                <tbody >

                </tbody>

                <tfoot>
                    <tr id="sub-total">
                        <td colspan="3" class="text-right"> Subtotal</td>
                        <td colspan="1" class="text-right" id="subTotal">$0.00</td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-right"> VAT</td>
                        <td colspan="1" class="text-right" id="vat">$0.00</td>
                    </tr>
                    <tr>
                        <td colspan="3" class="text-right"> Total Amount</td>
                        <td colspan="1" class="text-right" id="total">$0.00</td>
                    </tr>
                </tfoot>
            </table>
        
        <br>

        <p class="cen">
            <b>Make all checks payable to:</b>
            <br><i>Autosories Shop</i>
            <br><b>If you have any question concerning this invoices, call:</b>
            <br>
            <br><b>THANK YOU FOR YOUR BUSINESS</b>
        </p>


        <footer>Autosories Shop</footer>
    </div>

    <!-- <select id="accessory-select">
        <option value="10">Car Cover</option>
        <option value="20">Seat Covers</option>
        <option value="30">Phone Holder</option> -->
        <!-- Add more options here -->
    <!-- </select> -->
    <!-- <input type="number" id="amount-input" min="1" value="1"> -->
    <!-- <button class="add-button" onclick="addItem()">Add</button> -->
    <div class="modal fade" tabindex="-1" role="dialog" id="exampleModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Product</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped" rules="none">
                        <tr>
                            <td>Accessory</td>
                            <td>
                                <select id="accessory-select">
                                    <option value="10">Car Cover</option>
                                    <option value="20">Seat Covers</option>
                                    <option value="30">Phone Holder</option>
                                    <!-- Add more options here -->
                                </select>
                            </td>
                        </tr>
                        <tr style="background-color: white; ">
                            <td>Quantity</td>
                            <td><input type="number" min="0" id="amount-input"></td>
                        </tr>
                                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="addItem()">Add</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        var d = []
        function addItem() {
            // var accessorySelect = document.getElementById("accessory-select");
            // var selectedAccessory = accessorySelect.options[accessorySelect.selectedIndex].text;
            // var selectedAccessoryValue = accessorySelect.options[accessorySelect.selectedIndex].value;
            // var amountInput = document.getElementById("amount-input");
            // var amount = amountInput.value;
            // var accessoryTable = document.getElementById("accessory-table");
            // var price = parseFloat(selectedAccessoryValue)
            // var totalPrice = document.getElementById("total-price");
            // var vatAmount = document.getElementById("vatAmount");
            // var totalAmount = document.getElementById("totalAmount");
            // var productTable = document.getElementById("product-list");
            
            var accessorySelect = $('#accessory-select').val();
            var selectedAccessory = $('#accessory-select option:selected').text();
            var selectedAccessoryValue = $('#accessory-select option:selected').val();
            var amountInput = $('#amount-input').val();
            var quantity = parseFloat(amountInput);
            var accessoryTable = $('.accessory-table').val();
            var price = parseFloat(selectedAccessoryValue)
            var grossPrice = parseFloat($('#grossPrice').text().substring(1));
            var vatAmount = parseFloat($('#vatAmount').text().substring(1));
            var totalAmount = parseFloat($('#totalAmount').text().substring(1));
            console.debug(selectedAccessory, price, quantity)
            d.push({
                accessory: selectedAccessory,
                quantity: Number.parseFloat(quantity),
                unitPrice: Number.parseFloat(price)
            })
            $('#exampleModal').modal('hide')
            renderTable()
        }

        function renderTable(){
            var data = d
            var subTotal = 0
            data.forEach((e) => {
                subTotal = subTotal + (e.unitPrice * e.quantity)
            })
            var vat = (subTotal * .07).toFixed(2)
            var total = (subTotal * 1.07).toFixed(2)

            $("#subTotal").html("" + subTotal)
            $("#vat").html("" + vat)
            $("#total").html("" + total)

            var dataRows = data.map((e,i) => {
                let amount = e.quantity * e.unitPrice
                return `<tr class="data-row">
            <td class="data">
                <button onclick="deleteItem(${i})" style="background-color:#FF5E52; border:none; border-radius: 22%; margin-left: 4px; margin-top: 4px; margin-bottom: 4px;">X</button>
                ${e.accessory}
            </td>
            <td class="text-center">${e.quantity}</td>
            <td class="text-center">$${e.unitPrice.toFixed(2)}</td>
            <td class="text-right" style="margin-right: 10px;">$${amount.toFixed(2)}</td>
            </tr>`;                        
            })

            $(".data-row").remove()

            // Insert into the table
            dataRows.forEach((r) => {
                $('#quotationTable tbody').before(r)
            })
        }

        function deleteItem(i) {
            d.splice(i,1)
            renderTable()
        }

        $(document).ready(function () {
            $.getJSON('data/data.json',
                data => {
                    // render the table
                    d = data;

                    var d = new Date()
                    $('#quotationDate').html(d.toDateString())
                    renderTable()
                })
        })

            // var row = productTable.insertRow(-1);
            // var accessoryCell = row.insertCell(0);
            // var amountCell = row.insertCell(1);
            // var priceCell = row.insertCell(2);

            // var row = $('<tr>').appendTo('#product-list');
            // var accessoryCell = $('<td>').appendTo(row);
            // var amountCell = $('<td>').appendTo(row);
            // var priceCell = $('<td>').appendTo(row);
            
            // accessoryCell.innerHTML = selectedAccessory;
            // amountCell.innerHTML = amount
            // priceCell.innerHTML = "$" + (price * amount);
            // totalPrice.innerHTML = "$" + (parseFloat(totalPrice.innerHTML.substring(1)) + (price * amount));
            // vatAmount.innerHTML = "$" + (parseFloat(vatAmount.innerHTML.substring(1)) + (parseFloat(totalPrice.innerHTML.substring(1))) * 0.07).toFixed(2);
            // totalAmount.innerHTML = "$" + (parseFloat(totalAmount.innerHTML.substring(1)) + (parseFloat(totalPrice.innerHTML.substring(1))) + (parseFloat(vatAmount.innerHTML.substring(1))));

            // accessoryCell.text(selectedAccessory);
            // amountCell.text(amount);
            // var curr = price * amount;
            // priceCell.text('$' + curr);
            // grossPrice += curr;
            // $('#grossPrice').html('$'+ grossPrice);
            // vatAmount = grossPrice*0.07;
            // $('#vatAmount').html('$'+vatAmount.toFixed(2));
            // totalAmount = grossPrice + vatAmount;
            // $('#totalAmount').html('$'+totalAmount.toFixed(2));
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
        integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
        crossorigin="anonymous"></script>
</body>
</html>